<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3"
	layout:decorator="layout/template-default">
<head>
<title>CloudZ CP</title>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<script src="/js/common/namespaceCommon.js"
	data-th-src="@{/js/common/namespaceCommon.js}"></script>
<script th:inline="javascript" type="text/javascript">
	/*<![CDATA[*/
		
		$.alopex.page(function() {
         this.init = function(id, param) {
        	 $('.Progressbar').hide();
  			var namespace = /*[[${namespace}]]*/;
  			var status = /*[[${param.status}]]*/;
  			if(namespace){
  				$('#input_namespace').val(namespace);
  				initNamespace(namespace);
  				$('#span_namespace').text(namespace);
  				if('inactive' == status)
  					$('.active').removeClass('active').addClass('inactive');
  			}
  			getClusterRole();
  			registEvent();
//  			setView();
        	 
 			/**********************
	       	 SECRETS
	       	 **********************/
       	 	$('#btnSecretAdd').on(
 					'click',
 					function() {
 							secretPopup.pop({
 								url : "/management/popSecretAdd",
 								title : "Secret 추가",
 								data : {"namespace" : namespace},
 								width : 590,
 								height : 625,
 								callback : function() {
 									zcpSecretGrid.pageInit();
 								}
 							});
 					});
         }
		});
	
		function initNamespace(namespace){
			var url = "/management/namespace/getNamespaceResource";
			ajaxCall(url, {"namespace" : namespace}).done(function(data){
				var quota = data.hard;
				var limit = data.limitRange;
				var cpu_requeset, cpu_limit, memory_request, memory_limit;
				if(quota){
					$('#input_cpu_requests').val(quota.cpuRequests);
					$('#input_cpu_limits').val(quota.cpuLimits);
					$('#input_memory_requests').val(quota.memoryRequests);
					$('#input_memory_limits').val(quota.memoryLimits);
					$('#input_pods').val(quota.pods);
					$('#input_services').val(quota.services);
					$('#input_secrets').val(quota.secrets);
					$('#input_config_maps').val(quota.configmaps);
					$('#input_persistent_volumne').val(quota.persistentvolumeclaims);
					$('#input_load_balancers').val(quota.servicesLoadbalancers);
					selected('cpu_requests', quota.cpuRequestsUnit, 'MilliCore');
					selected('cpu_limits', quota.cpuLimitsUnit, 'MilliCore');
					selected('memory_requests', quota.memoryRequestsUnit, 'Mi');
					selected('memory_limits', quota.memoryLimitsUnit, 'Mi');
				}
				if(limit){
					$('#input_pod_cpu_requests').val(limit.cpuRequests);
					$('#input_pod_cpu_limits').val(limit.cpuLimits);
					$('#input_pod_memory_requests').val(limit.memoryRequests);
					$('#input_pod_memory_limits').val(limit.memoryLimits);
					selected('pod_cpu_requests', limit.cpuRequestsUnit, 'MilliCore');
					selected('pod_cpu_limits', limit.cpuLimitsUnit, 'MilliCore');
					selected('pod_memory_requests', limit.memoryRequestsUnit, 'Mi');
					selected('pod_memory_limits', limit.memoryLimitsUnit, 'Mi');
				}
				if(data.namespace){
					$('#input_namespace').val(data.namespace)
				}
				var maxCnt = 1000;
				/* var cpuRq = data.used.cpuRequests / data.hard.cpuRequests * 100;
				var cpuLm = data.used.cpuLimits / data.hard.cpuLimits * 100;
				var memRm = data.used.memoryRequests / data.hard.memoryRequests * 100;
				var memLm = data.used.memoryLimits / data.hard.memoryLimits * 100;
				var pods =  data.used.pods / data.hard.pods *100;
				var services = data.used.pods / data.hard.pods *100;
				var secrets = data.used.secrets / data.hard.secrets *100;
				var configMaps = data.used.configMaps / data.hard.configMaps *100;
				var persistentVolumne = data.used.persistentvolumeclaims / data.hard.persistentvolumeclaims *100;
				var loadbalancers = data.used.servicesLoadbalancers / data.hard.servicesLoadbalancers *100;  */
				if(data.usage){
					setGraph('cpu_requests', data.usage.cpuRequestsUsage, quota.cpuRequests);
					setGraph('cpu_limits', data.usage.cpuLimitsUsage, quota.cpuLimits);
					setGraph('memory_requests', data.usage.memoryRequestsUsage, quota.memoryRequests);
					setGraph('memory_limits', data.usage.memoryLimitsUsage, quota.memoryLimits);
					setGraph('pods', data.usage.podsUsage, quota.pods);
					setGraph('services', data.usage.servicesUsage, quota.services);
					setGraph('secrets', data.usage.secretsUsage, quota.secrets);
					setGraph('config_maps', data.usage.configmapsUsage, quota.configmaps);
					setGraph('persistent_volumne', data.usage.persistentvolumeclaimsUsage, quota.persistentvolumeclaims);
					setGraph('load_balancers', data.usage.servicesLoadbalancersUsage, quota.servicesLoadbalancers);
				}
				
				setView();
			});
			url = "/management/namespace/labels";
			ajaxCall(url, {"namespace" : namespace}).done(function(data){
				var isClusterAdmin = /*[[${view}]]*/;
				
				if(data.items){
					var html='';
					$.each(data.items, function(idx, data){
						
							html +=makeHtmlLabel(data);	
					});
					$('#div_label').append(html);
				}
				function makeHtmlLabel(name){
					var html = '<span class="Label Default" >'+name+'</span>';
					if(isClusterAdmin && !(name.indexOf('cloudzcp.io/zcp-system=') > -1) && !(name.indexOf('cloudzcp.io/zdb-system=') > -1))
						html +='<button class="btn-ico label-del" onclick="delLabel(\''+name+'\')">삭제</button>';
					return html;
				}
			});
			
			
			
			function setGraph(obj_id, used, c){
				var func = (c || c==0) ? 'hide' : 'show';
				var $bar = $('#div_' +obj_id)[func]();
				var $label = $('#span_'+ obj_id)[func]();
				
				if(func === 'hide')
					return;
				
				var used = Number(used);
				used = (used == parseInt(used) ? used : used.toFixed(2));
				
				var color = 'name-typea';
				if(30 < used && used < 90) 
					color = 'name-typee';
				else if(90 <= used)
					color = 'name-typec';

				$bar.setValue(used);
				$bar.removeClass('name-typea').addClass(color);
				$label.text(used + '%');
				
				return;
			}
			
			function selected(id, value, unit){
				if(value && value.indexOf(unit) > -1) 
					$('#select_'+id).setSelected(unit)
			}
			
		}
		
		function setView(){
			var isClusterAdmin = /*[[${view}]]*/;
			if(!isClusterAdmin){
				$('#div_btnSave').hide();
				$('#btn_addLabel').hide();
				$('#input_label').hide();
				$('#div_resource').find('input, .Divselect').setEnabled(false);
			}
		}
		
		function registEvent(){
			$('#searchWord1').keypress(function(event){
				if(event.which == 13){
					search1();
				} 
			});
			$('#searchWord2').keypress(function(event){
				if(event.which == 13){
					search2();
				} 
			});
		}
		
		function addNamespace(){
			if(!validate()) return ;
			
			var data={
				namespace : /*[[${namespace}]]*/
				,resourceQuota : {
					"cpuRequests" : $('#input_cpu_requests').val() ? $('#input_cpu_requests').val() + '': null
					,"cpuRequestsUnit" : $('#select_cpu_requests option:selected').val()
					,"cpuLimits" : $('#input_cpu_limits').val() ? $('#input_cpu_limits').val() + '': null
					,"cpuLimitsUnit" : $('#select_cpu_limits option:selected').val() 
					,"memoryRequests" : $('#input_memory_requests').val() ? $('#input_memory_requests').val() + '': null
					,"memoryRequestsUnit" : $('#select_memory_requests option:selected').val()
					,"memoryLimits" : $('#input_memory_limits').val() ? $('#input_memory_limits').val() + '': null
					,"memoryLimitsUnit": $('#select_memory_limits option:selected').val() 
					,"pods" : $('#input_pods').val() ? $('#input_pods').val() + '': null 
					,"services" : $('#input_services').val() ? $('#input_services').val() + '': null
					,"secrets" : $('#input_secrets').val() ? $('#input_secrets').val()+ '' : null
					,"configmaps" : $('#input_config_maps').val() ? $('#input_config_maps').val()+ '' : null
					,"persistentvolumeclaims" : $('#input_persistent_volumne').val() ? $('#input_persistent_volumne').val()+ '' : null
					,"servicesLoadbalancers" : $('#input_load_balancers').val() ? $('#input_load_balancers').val()+ '' : null
				},
				limitRange : {
					cpuRequests : $('#input_pod_cpu_requests').val() ? $('#input_pod_cpu_requests').val() + '': null
					,cpuRequestsUnit :  $('#select_pod_cpu_requests option:selected').val()
					,memoryRequests:  $('#input_pod_memory_requests').val() ? $('#input_pod_memory_requests').val() + '': null
					,memoryRequestsUnit : $('#select_pod_memory_requests option:selected').val()
					,cpuLimits :  $('#input_pod_cpu_limits').val() ? $('#input_pod_cpu_limits').val() + '': null
					,cpuLimitsUnit : $('#select_pod_cpu_limits option:selected').val()
					,memoryLimits : $('#input_pod_memory_limits').val() ? $('#input_pod_memory_limits').val() + '': null
					,memoryLimitsUnit : $('#select_pod_memory_limits option:selected').val()
				}
			};
			
			commonPopup.confirm({
                //title: '비밀번호 재설정',
                message: 'Namespace 를 구성을 변경하시겠습니까?',
                callback: function() {
                	
                	var url = "/management/namespace/createAndEdit";
        			
        			ajaxCall(url, data).done(function(data){
        				commonPopup.alert({
                            message: 'Namespace 구성 정보를 변경하였습니다.',
                            callback: function() {
                            	location.reload();
                            }
                        });
        			});      
                }
            });
			
			
		}
		
		function validate(){
			var regex_namespace = /^[a-zA-Z][0-9a-zA-z\-]{5,11}$/;
			if(!regex_namespace.test($('#input_namespace').val())){
				commonPopup.alert({
                    message: '허용하지 않는 문자입니다.',
                    callback: function() {
                    }
                });
				return false;
			}
			
			return true;
		}
		/////////////////////////////////////  member management /////////////////////////////////////
		var g_namespaceMember = null; 
		var g_listCount = 5;
		
		function gridInitMember(data){
			g_namespaceMember = data;
			
			AlopexGrid.setup({
	    		fitTableWidth : true 
	    	});
	    	//memeber
	    	$('#grid_member').alopexGrid({
	    		cellInlineEdit: true,
	    		rowInlineEdit: true,
	    		pager: true,
	    		paging: {
	    			perPage: g_listCount,
	    			pagerCount: 5,
	    			pagerSelect: true,
	                pagerTotal: true
	    		},
	            defaultColumnMapping : {
	                sorting:true
	            },
	    		autoColumnIndex: true,
	    		columnMapping : [
	    			{
	    				key : 'username',
	    				title : '사용자 ID',
	    				width : '100px'
	    			}, {
	    				key : 'email',
	    				title : '이메일',
	    				width : '100px'
	    			}, {
	    				key : 'firstName',
	    				title : '이름',
	    				width : '100px',
	    				render : function( value, data, render, mapping){
	    					return data.firstName;
	    				}
	    				
	    			}, {
	    				align : 'center',
	    				key : 'namespacedRole',
	    				title : 'Namespace 권한',
	    				width : '100px',
	    				render : {
	    		            type : "select",
	    		            rule : g_clusterRole,
	    		            styleclass : "group-select"
	    		        },
	    		        editable : {
	    		            type : "select",
	    		            rule : g_clusterRole,
	    		            styleclass : "group-select"
	    		        }
	    			}, {
	    				align : 'center',
	    				key : 'createdDate',
	    				title : '멤버 등록 일시',
	    				width : '100px',
	    				render : function(value, data, render, mapping){
	    					var dt = new Date(Number(data.createdDate));
	    					return dt.customFormat( "#YYYY#/#MM#/#DD# #hh#:#mm#:#ss#" )
	    				}
	    			}, {
	    				align : 'center',
	    				key : 'enabled',
	    				title : '사용자 상태',
	    				width : '100px',
	    				render : function(value, data){
	    					return value==true ? "active" : "inactive";
	    				}
	    			}, {
	    				key : 'country',
	    				align : 'center',
	    				title : '관리',
	    				width : '50px',
	    				render : function(value, data, render, mapping){
	    					var namespace = /*[[${namespace}]]*/;
	    					var apply = {namespace:namespace, clusterRole : data.namespacedRole, username : data.username}
	    					return "<button class='btn-ico btn-config__save'  onclick='modifyNamespaceRole("+JSON.stringify(apply) +")'></button>&nbsp;" 
	    						+"<button class=\"btn-ico del\" onclick='delUser(" + JSON.stringify(data) + ")'></button>";
	    				}
	    			}
	    		],
	    		data: data
	    	});
	    	$("#grid_member").on( "perPageChange" , function(grid, pageinfo){
				g_listCount = grid.alopexgrid.perPage;
			});
		}
	    
		function gridInitUser(data){ 
	    	//user
	    	function initData(data){
	    		$.each(data, function(idx, row){
	    			row.namespacedRole = g_clusterRole && g_clusterRole[g_clusterRole.length-1].value || 'developer';
	    		});
	    		return data;
	    	}
	    	data = initData(data);
	    	$('#div_grid_user').show();
	    	$('#grid_user').alopexGrid({
	    		cellInlineEdit: true,
	    		pager: true,
	    		paging: {
	    			perPage: 5,
	    			pagerCount: 5,
	    			pagerSelect: true,
	                pagerTotal: true
	    		},
	            defaultColumnMapping : {
	                sorting:true
	            },
	    		autoColumnIndex: true,
	    		columnMapping : [
	    			{
	    				key : 'username',
	    				title : '사용자 ID',
	    				width : '100px'
	    			}, {
	    				key : 'email',
	    				title : '이메일',
	    				width : '100px'
	    			}, {
	    				key : 'lastName',
	    				title : '이름',
	    				width : '100px',
	    				render : function( value, data, render, mapping){
	    					return data.firstName;
	    				}
	    			}, {
	    				align : 'center',
	    				key : 'clusterRole',
	    				title : 'Cluster 권한',
	    				width : '100px',
	    				render : function(value, data){
	    					return value ? value : 'none';
	    				}
	    			},{
	    				align : 'center',
	    				key : 'namespacedRole',
	    				title : 'Namespace 권한',
	    				width : '100px',
	    				render : {
	    		            type : "select",
	    		            rule : g_clusterRole
    		                 
	    		        },
	    				editable : {
	    		            type : "select",
	    		            rule : g_clusterRole
	    		        }
	    			}, {
	    				align : 'center',
	    				key : 'createdDate',
	    				title : '생성 일시',
	    				width : '100px',
	    				render : function(value, data, render, mapping){
	    					var dt = new Date(Number(data.createdDate));
	    					return dt.customFormat( "#YYYY#/#MM#/#DD# #hh#:#mm#:#ss#" )
	    				}
	    			}, {
	    				align : 'center',
	    				key : 'enabled',
	    				title : '상태',
	    				width : '100px',
    					render : function(value, data){
        					return value==true ? "active" : "inactive";
        				}
	    			}, {
	    				align : 'center',
	    				title : '추가',
	    				width : '50px',
	    				render : function(value, data, render, mapping){
	    					return "<button class=\"btn-ico list-add\" onclick=\'addUser(" + JSON.stringify(data) + ")'></button>";
	    				}
	    			}
	    		],
	    		data: data
	    	});
		}
		var g_clusterRole = null;
		function getClusterRole(){
			if(g_clusterRole) return ;
    		var rtn=[];
    		var defferd = ajaxCall('/management/namespace/authority',{}).done(function(data){
    			$.each(data , function(idx, v){
    				rtn.push({value : v, text : v});
        		});
    			g_clusterRole = rtn;
    			
    		})
    		return g_clusterRole;
    	}
		
		function showMember(){
			var namespace = /*[[${namespace}]]*/;
			var memberList;
			$('#div_member').show();
			$('#div_resource').hide();
			$('#div_search2').show();
			
			$('#div_secret').hide();
			
			gridInitUser();

			ajaxCall('/management/namespace/users', {namespace : namespace}).done(function(data){
				gridInitMember(data.items);
			});
		}
		
		function showResource(){
			$('#div_member').hide();
			$('#div_secret').hide();
			$('#div_resource').show();
		}
		
		function showPopAddMember(){
			var namespace = /*[[${namespace}]]*/;
			$a.popup({
		        url: "./pop/popUserCreate.html",
		        iframe: false,  // default 는 true
		        width: 550,
		        height: 550,
		        title : "멤버 생성",
		        data : {namespace : namespace},
		        callback : function(data, obj){
		        	if(data=='ok'){
		        				
		        	}else if(data == 'close'){
		        		//location.reload();
		        	}
		        },
		        alias: "flag1"
		    });
		}
		
		function addUser(data){
			var namespace = /*[[${namespace}]]*/;
			if(!data.clusterRole){
				//alert('Cluster 권한이 필요합니다.');
				commonPopup.alert({
                    message: 'Cluster 권한이 필요합니다.',
                    callback: function() {
                    }
                });
				return ;
			}
			if(!data.namespacedRole) {
				//alert('Namespace 권한이 필요합니다.');
				commonPopup.alert({
                    message: 'Namespace 권한이 필요합니다.',
                    callback: function() {
                    }
                });
				return ;
			}
			var isDup = isDupMemberCheck(data.username);
			if(isDup) {
				//alert('이미 추가된 사용자 입니다.');
				commonPopup.alert({
                    message: '이미 추가된 멤버 입니다.',
                    callback: function() {
                    }
                });
				return ;
			}
			var userName = data.username;
			commonPopup.confirm({
                //title: '',
                message: userName + '를 멤버로 추가하시겠습니까?',
                callback: function() {
                	var user = {
           				"username" : data.username
           				,"namespace" : namespace 
           				,"clusterRole" : data.namespacedRole
           				//,"namespaceRole" : data.namespacedRole
             				,"id" : data.id
           			};
           			ajaxCall('/management/namespace/saveRole', user).done(function(data){
           				gridInitMember(data.items);
           				commonPopup.alert({
                            message: userName + '가 멤버로 추가되었습니다.',
                            callback: function() {
                            }
                        });
           				showMember();
           			});        
                }
            });
			
		}
		
		function isDupMemberCheck(username){
			var rtn = false;
			$.each(g_namespaceMember, function(idx, member){
				if(member.username == username)
					rtn = true;
			});
			return rtn;
		}
		
		function modifyNamespaceRole(data){
			if(!data.clusterRole) {
				//alert('Namespace 권한이 필요합니다.');
				commonPopup.alert({
                    message: 'Namespace 권한이 필요합니다.',
                    callback: function() {
                    }
                });
				return ;
			}
			var namespace = /*[[${namespace}]]*/;
			ajaxCall('/management/namespace/modifyRole', data).done(function(data){
				//alert('정상처리되었습니다.');
				commonPopup.alert({
                    message: '정상처리되었습니다.',
                    callback: function() {
                    }
                });
			});
		}
		
		function delUser(data){
			var namespace = /*[[${namespace}]]*/;
			var user = {
					"username" : data.username
					,"namespace" : namespace 
					,"clusterRole" : data.namespacedRole
	  				,"id" : data.id
				};
			var userName = data.username;
			commonPopup.confirm({
                //title: '비밀번호 재설정',
                message: data.username + ' 멤버를 삭제하시겠습니까?',
                callback: function() {
                	ajaxCall('/management/namespace/delRole', user).done(function(data){
    					//alert('정상처리되었습니다.');
    					commonPopup.alert({
    	                    message: userName + ' 멤버를 삭제되었습니다.',
    	                    callback: function() {
    	                    }
    	                });
    					showMember();
    				});	 
                }
            });
		}
		
		function search1(){
			var word = $('#searchWord1').val();
			var namespace = /*[[${namespace}]]*/;
			var user = {
					"namespace" : namespace 
					,"searchWord" : word
				};
			ajaxCall('/management/namespace/users', user).done(function(data){
				gridInitMember(data.items);
				$("#grid_member").alopexGrid( "viewUpdate" );
			});
		}
		
		function search2(){
			var word = $('#searchWord2').val();
			var namespace = /*[[${namespace}]]*/;
			var user = {
					"searchWord" : word
				};
			ajaxCall('/management/namespace/users', user).done(function(data){
				gridInitUser(data.items);
				$("#grid_member").alopexGrid( "viewUpdate" );
			});
		}
		
		function addLabel(){
			var namespace = /*[[${namespace}]]*/;
			var label = $('#input_label').val();
			var regex = /[a-z][a-z0-9\/\-]*[=]{1}[a-zA-Z0-9\/\-]+/
			commonPopup.confirm({
                //title: '비밀번호 재설정',
                message: '라벨을 추가 하시겠습니까? ',
                callback: function() {
                	if(!regex.test(label)){
                		$('#span_validation').show();
                        $('#span_validation').text('라벨 형식이 올바르지 않습니다');
                        $('#input_label').focus();
        				return ;
        			}
        			ajaxCall('/management/namespace/addLabel', {namespace : namespace, label : label}).done(function(data){
        				commonPopup.alert({
                            message: '라벨이 추가되었습니다.',
                            callback: function() {
                            	location.reload();
                            }
                        });
        			});
                }
            });
			
		}
		
		function delLabel(label){
			if(label.indexOf('cloudzcp.io/zcp-system=') > -1){
				//alert('삭제 할수 없습니다.');
				commonPopup.alert({
                    message: '삭제 할수 없습니다.',
                    callback: function() {
                    }
                });
				return ;
			}
			var namespace = /*[[${namespace}]]*/;
			commonPopup.confirm({
                //title: '비밀번호 재설정',
                message: '라벨을 삭제 하시겠습니까?',
                callback: function() {
                	ajaxCall('/management/namespace/delLabel', {namespace : namespace, label : label}).done(function(data){
                		commonPopup.alert({
                            message: '라벨이 삭제되었습니다.',
                            callback: function() {
                            	location.reload();
                            }
                        });
        			});
                }
            });
			
		}
		
		function goMain(){
			var namespace = /*[[${namespace}]]*/;
			location.href='/?namespace='+namespace;
		}
		
		function goUser(){
			location.href='/management/users';
		}
		
		
		
		/*************************
		SECRETS
		**************************/
		function showSecret() {
			$('#div_resource').hide();
			$('#div_member').hide();
			$('#div_secret').show();
			
			zcpSecretGrid.pageInit();
		}
		
		var zcpSecretGrid = {
				pageInit : function() {
					'use strict';
					this.grid.init();
					this.data.init();
					this.event.init();
				},
				grid : {
					init : function() {
						$("#grid_secret").removeAlopexGrid();
						$("#grid_secret")
								.alopexGrid(
										{
											pager : true,
											fitTableWidth : true,
											filteringHeader : false,
											filter : {
												movable : true,
												saveFilterSize : true,
												title : true
											},
											paging : {
												perPage : 5,
												pagerCount : 5,
												pagerSelect : true,
												pagerTotal : true
											},
											defaultSorting : {
												sortingColumn : 'date',
												sortingDirection : 'desc'
											},
											defaultColumnMapping : {
												sorting : true,
												resizing : true
											},
											message : {
												nodata : '데이타가 없습니다.'
											},
											enableDefaultContextMenu : false,
											autoColumnIndex : true,
											columnMapping : [
													{
														key : 'name',
														title : 'Secret Name',
														width : '200px',
														align : 'left',
														render : function(value, data) {
															return '<a href="javascript:zcpSecretGrid.data.detailSecret(\''
																	+ data.name
																	+ '\', \''
																	+ data.type
																	+ '\');" style="font-size:15px; ">'
																	+ data.name
																	+ '</a>';
														}
													},
													{
														key : 'type',
														title : 'Secret Type',
														width : '200px',
														align : 'left'
													},
													{
														key : 'date',
														title : '생성 일시',
														width : '150px',
														align : 'center'
													},
													{
														key : 'label',
														title : 'Label',
														width : '200px',
														align : 'left'
													},
													{
														key : 'delete',
														title : '관리',
														width : '100px',
														align : 'center',
														render : function(value, data) {
															return '<button class="btn-ico del" onclick="zcpSecretGrid.data.deleteSecret(\''
																	+ data.name
																	+ '\');" />';
														}
													}
												],
										});
					},
				},
				data : {
					init : function() {
						this.getList();
					},
					getList : function() {
						var namespace = /*[[${namespace}]]*/;
						var jsonData = {
								namespace : namespace
							};
						$a.request('/management/getSecrets/'+namespace, {
							method : 'get',
							data : null,
							success : function(res) {
								if (res.resultCd !== '200') {
									if (res.resultMsg)
										alert(res.resultMsg);
									return false;
								}

								$('#grid_secret').alopexGrid('dataSet', res.resultData);
							},
							error : function(errObject) {
								alert('처리 중 오류가 발생하였습니다. 잠시 후 다시 시도하세요.');
							}
						})
					},
					detailSecret : function(name, type) {
						var namespace = /*[[${namespace}]]*/;
						var jsonData = {
								namespace : namespace,
								name : name,
								type : type
							};
						
						var widthVal = "";
						var heightVal = "";
						
						if(type == "Docker Registry") {
							widthVal = "590";
							heightVal = "585";
							
						} else if(type == "TLS") {
							widthVal = "590";
							heightVal = "480";
						}
						secretPopup.pop({
							url : "/management/popSecretDtl/" + namespace + "/" + name,
							title : "Secret 정보",
							data : jsonData,
							width : widthVal,
							height : heightVal
						});
					},
					deleteSecret : function(name) {
						var namespace = /*[[${namespace}]]*/;
						var jsonData = {
							namespace : namespace,
							name : name
						};
						secretDelPop.confirm({
							width : 450,
							height : 300,
							data : jsonData,
							name : name,
							callback : function(data) {
								if (data == 'ok') {
									$a.request('/management/deleteSecret/' + namespace + '/' + name, {
										method : 'post',
										data : jsonData,
										success : function(res) {
											if (res.resultCd !== '200') {
												return false;
											} else {
												alertPopup.alert({
													width : 400,
													height : 250,
													message : 'Secret이 삭제되었습니다.',
													callback : function() {
														zcpSecretGrid.pageInit();
													}
												});
											}
										},
										error : function(errObject) {
										}
									})
								} else {
									return false;
								}
							}
						});
					}
				}, 
				event : {
					init : function() {
						$('#btnSearch').on(
								'click',
								function() {
									var customFilter = null;
									try {
										customFilter = eval("("
												+ $("#customFunction").val() + ")");
									} catch (e) {
									}
									if (!customFilter || !$.isFunction(customFilter)) {
										alert("올바르지 않은 필터함수 입니다.");
										return;
									}
									$("#grid_secret").alopexGrid('setFilter',
											'customFilter', customFilter);
								});
						$('#keyword')
								.on(
										'keydown',
										function(e) {
											if (e.keyCode === 13) {
												var customFilter = null;
												try {
													customFilter = eval("("
															+ $("#customFunction")
																	.val() + ")");
												} catch (e) {
												}
												if (!customFilter
														|| !$.isFunction(customFilter)) {
													alert("올바르지 않은 필터함수 입니다.");
													return;
												}
												$("#grid_secret").alopexGrid('setFilter',
														'customFilter', customFilter);
											}
										});
						
					}
				}
			}
		
	 /*]]>*/
    </script>
</head>
<body>
	<div class="cp-wrapper">
		<th:block layout:fragment="content">
			<textarea id="customFunction" style="display: none;">
				function(data) {
					return data['name'].toLowerCase().indexOf($("#keyword").val().toLowerCase()) >= 0;
				}
			</textarea>
			<!-- main-contents -->
			<div class="cp-container">
				<!-- contents -->
				<div class="contents-wrap">
					<!-- location -->
					<th:block th:include="common/include/namespace :: common"
						th:with="listUrl='/management/namespaces'"></th:block>
					<!-- <div class="locations-area">
				<div class="back-list"><a href="/management/namespaces"><span>목록으로 돌아가기</span></a></div>
			</div> -->
					<div class="contents-box">
						<!-- service top area-->
						<div class="top-area">
							<dl class="service-info">
								<dt>
									<span id="span_namespace"></span> <span class="state active"></span>
									<p class="Tooltip" data-position="right">Active</p>
								</dt>
								<dd class="service-user">
									<strong>생성일시</strong> : <span>2018-06-01 00:33:55</span>
								</dd>
							</dl>
							<div class="btn-wrap__right">
								<button class="Button btn-ico__typeb btn-godash"
									onclick='goMain()'>Dashoboard 보기</button>
								<div class="Tooltip" data-position="left">대시보드 화면으로 이동</div>
								<!-- <button class="Button btn-ico__typeb btn-adduser" onclick='goUser()'></button> -->
							</div>
						</div>
						<!-- tab wrap -->
						<div class="Tabs Fixed" data-tab-width="180px">
							<ul>
								<li data-content="#tab1" onclick="showResource()">Resource
									구성</li>
								<li data-content="#tab2" onclick="showMember()">멤버관리</li>
								<li data-content="#tab3" onclick="showSecret();">Secret</li>
							</ul>
							<!-- Resource modify구성 -->
							<div id="div_resource">
								<p class="intab-txt">Namespace의 Resource 구성정보를 조회 및 변경합니다.</p>
								<!-- intab tag-->
								<div class="intab-tag__wrap">
									<h3 class="form-title">라벨</h3>
									<div class="tag-wrap">
										<div id="div_label"></div>
										<input class="Autocomplete add-label__input" id="input_label"
											style="width: 300px" />
										<button class="Label add-label" onclick="addLabel()"
											id="btn_addLabel">추가</button>
										<br /> <span style="font-size: 15px; color: red"
											id="span_validation"></span>
									</div>
								</div>
								<!-- namespace name detail data-->
								<div class="lay-item__box">
									<!-- left table-->
									<div class="lay-item__left">
										<h3 class="form-title">Resource Quotas</h3>
										<form>
											<fieldset>
												<table class="Table Form-type tbl-name">
													<colgroup>
														<col style="width: 180px;" />
														<col />
													</colgroup>
													<tbody>
														<tr>
															<th>CPU Requests</th>
															<td>
																<div class="tbl-group__wrap">
																	<div class="left">
																		<input data-keyfilter-rule="digits" maxLength="4"
																			class="Textinput" id="input_cpu_requests" />
																	</div>
																	<div class="left">
																		<div class="Divselect" id="select_cpu_requests"
																			style="width: 90px; min-width: 90px">
																			<select>
																				<option value="Core">Core</option>
																				<option value="MilliCore">MilliCore</option>
																			</select> <span></span>
																		</div>
																	</div>
																	<div class="name-pro_position">
																		<div class="name-pro__wrap">
																			<div class="Progressbar name-typea" data-default="0"
																				id="div_cpu_requests"></div>
																		</div>
																		<span class="name-pro__num" id="span_cpu_requests"></span>
																	</div>
																</div>
															</td>
														</tr>
														<tr>
															<th>CPU Limits</th>
															<td>
																<div class="tbl-group__wrap">
																	<div class="left">
																		<input data-keyfilter-rule="digits" maxLength="4"
																			class="Textinput" id="input_cpu_limits" />
																		<div class="Divselect" id="select_cpu_limits"
																			style="width: 90px; min-width: 90px">
																			<select>
																				<option value="Core">Core</option>
																				<option value="MilliCore">MilliCore</option>
																			</select> <span></span>
																		</div>
																	</div>
																	<div class="name-pro_position">
																		<div class="name-pro__wrap">
																			<div class="Progressbar name-typea" data-default="0"
																				id="div_cpu_limits"></div>
																		</div>
																		<span class="name-pro__num" id="span_cpu_limits"></span>
																	</div>
																</div>
															</td>
														</tr>
														<tr>
															<th>Memory Requests</th>
															<td>
																<div class="tbl-group__wrap">
																	<div class="left">
																		<input data-keyfilter-rule="digits" maxLength="4"
																			class="Textinput" id="input_memory_requests" />
																		<div class="Divselect" id="select_memory_requests"
																			style="width: 90px; min-width: 90px">
																			<select>
																				<option value="Gi">Gi</option>
																				<option value="Mi">Mi</option>
																			</select> <span></span>
																		</div>
																	</div>
																	<div class="name-pro_position">
																		<div class="name-pro__wrap">
																			<div class="Progressbar name-typea" data-default="0"
																				id="div_memory_requests"></div>
																		</div>
																		<span class="name-pro__num" id="span_memory_requests"></span>
																	</div>
																</div>
															</td>
														</tr>
														<tr>
															<th>Memory Limits</th>
															<td>
																<div class="tbl-group__wrap">
																	<div class="left">
																		<input data-keyfilter-rule="digits" maxLength="4"
																			class="Textinput" id="input_memory_limits" />
																		<div class="Divselect" id="select_memory_limits"
																			style="width: 90px; min-width: 90px">
																			<select>
																				<option value="Gi">Gi</option>
																				<option value="Mi">Mi</option>
																			</select> <span></span>
																		</div>
																	</div>
																	<div class="name-pro_position">
																		<div class="name-pro__wrap">
																			<div class="Progressbar name-typea" data-default="0"
																				id="div_memory_limits"></div>
																		</div>
																		<span class="name-pro__num" id="span_memory_limits"></span>
																	</div>
																</div>
															</td>
														</tr>
														<tr>
															<th>Pods</th>
															<td>
																<div class="tbl-group__wrap">
																	<div class="left">
																		<input data-keyfilter-rule="digits" maxLength="4"
																			class="Textinput" id="input_pods" /><span
																			class="num-txt">개</span>
																	</div>
																	<div class="name-pro_position">
																		<div class="name-pro__wrap">
																			<div class="Progressbar name-typea" data-default="0"
																				id="div_pods"></div>
																		</div>
																		<span class="name-pro__num" id="span_pods"></span>
																	</div>
																</div>
															</td>
														</tr>
														<tr>
															<th>Services</th>
															<td>
																<div class="tbl-group__wrap">
																	<div class="left">
																		<input data-keyfilter-rule="digits" maxLength="4"
																			class="Textinput" id="input_services" /><span
																			class="num-txt">개</span>
																	</div>
																	<div class="name-pro_position">
																		<div class="name-pro__wrap">
																			<div class="Progressbar name-typea" data-default="0"
																				id="div_services"></div>
																		</div>
																		<span class="name-pro__num" id="span_services"></span>
																	</div>
																</div>
															</td>
														</tr>
														<tr>
															<th>Secrets</th>
															<td>
																<div class="tbl-group__wrap">
																	<div class="left">
																		<input data-keyfilter-rule="digits" maxLength="4"
																			class="Textinput" id="input_secrets" /><span
																			class="num-txt">개</span>
																	</div>
																	<div class="name-pro_position">
																		<div class="name-pro__wrap">
																			<div class="Progressbar name-typea" data-default="0"
																				id="div_secrets"></div>
																		</div>
																		<span class="name-pro__num" id="span_secrets"></span>
																	</div>
																</div>
															</td>
														</tr>
														<tr>
															<th>Config Maps</th>
															<td>
																<div class="tbl-group__wrap">
																	<div class="left">
																		<input data-keyfilter-rule="digits" maxLength="4"
																			class="Textinput" id="input_config_maps" /><span
																			class="num-txt">개</span>
																	</div>
																	<div class="name-pro_position">
																		<div class="name-pro__wrap">
																			<div class="Progressbar name-typea" data-default="0"
																				id="div_config_maps"></div>
																		</div>
																		<span class="name-pro__num" id="span_config_maps"></span>
																	</div>
																</div>
															</td>
														</tr>
														<tr>
															<th>Persistent Volume<br />Claims
															</th>
															<td>
																<div class="tbl-group__wrap">
																	<div class="left">
																		<input data-keyfilter-rule="digits" maxLength="4"
																			class="Textinput" id="input_persistent_volumne" /><span
																			class="num-txt">개</span>
																	</div>
																	<div class="name-pro_position">
																		<div class="name-pro__wrap">
																			<div class="Progressbar name-typea" data-default="0"
																				id="div_persistent_volumne"></div>
																		</div>
																		<span class="name-pro__num"
																			id="span_persistent_volumne"></span>
																	</div>
																</div>
															</td>
														</tr>
														<tr>
															<th>Services Load<br />Balancers
															</th>
															<td>
																<div class="tbl-group__wrap">
																	<div class="left">
																		<input data-keyfilter-rule="digits" maxLength="4"
																			class="Textinput" id="input_load_balancers" /><span
																			class="num-txt">개</span>
																	</div>
																	<div class="name-pro_position">
																		<div class="name-pro__wrap">
																			<div class="Progressbar name-typea" data-default="0"
																				id="div_load_balancers"></div>
																		</div>
																		<span class="name-pro__num" id="span_load_balancers"></span>
																	</div>
																</div>
															</td>
														</tr>
													</tbody>
												</table>
											</fieldset>
										</form>
									</div>
									<!--right table-->
									<div class="lay-item__right">
										<h3 class="form-title">Pod Default Limit Range</h3>
										<form>
											<fieldset>
												<table class="Table Form-type tbl-name">
													<colgroup>
														<col style="width: 180px;" />
														<col />
													</colgroup>
													<tbody>
														<tr>
															<th>CPU Requests</th>
															<td>
																<div class="tbl-group__wrap">
																	<div class="left">
																		<input data-keyfilter-rule="digits" maxLength="4"
																			class="Textinput" id="input_pod_cpu_requests" />
																		<div class="Divselect" id="select_pod_cpu_requests"
																			style="width: 90px; min-width: 90px">
																			<select>
																				<option value="Core">Core</option>
																				<option value="MilliCore">MilliCore</option>
																			</select> <span></span>
																		</div>
																	</div>
																</div>
															</td>
														</tr>
														<tr>
															<th>CPU Limits</th>
															<td>
																<div class="tbl-group__wrap">
																	<div class="left">
																		<input data-keyfilter-rule="digits" maxLength="4"
																			class="Textinput" id="input_pod_cpu_limits" />
																		<div class="Divselect" id="select_pod_cpu_limits"
																			style="width: 90px; min-width: 90px">
																			<select>
																				<option value="Core">Core</option>
																				<option value="MilliCore">MilliCore</option>
																			</select> <span></span>
																		</div>
																	</div>
																</div>
															</td>
														</tr>
														<tr>
															<th>Memory Requests</th>
															<td>
																<div class="tbl-group__wrap">
																	<div class="left">
																		<input data-keyfilter-rule="digits" maxLength="4"
																			class="Textinput" id="input_pod_memory_requests" />
																		<div class="Divselect" id="select_pod_memory_requests"
																			style="width: 90px; min-width: 90px">
																			<select>
																				<option value="Gi">Gi</option>
																				<option value="Mi">Mi</option>
																			</select> <span></span>
																		</div>
																	</div>
																</div>
															</td>
														</tr>
														<tr>
															<th class="Valign-top" style="height: 420px;">Memory
																Limits</th>
															<td class="Valign-top">
																<div class="tbl-group__wrap">
																	<div class="left">
																		<input data-keyfilter-rule="digits" maxLength="4"
																			class="Textinput" id="input_pod_memory_limits" />
																		<div class="Divselect" id="select_pod_memory_limits"
																			style="width: 90px; min-width: 90px">
																			<select>
																				<option value="Gi">Gi</option>
																				<option value="Mi">Mi</option>
																			</select> <span></span>
																		</div>
																	</div>
																</div>
															</td>
														</tr>
													</tbody>
												</table>
											</fieldset>
										</form>
									</div>
								</div>
								<!-- button wrap-->
								<div class="btn-wrap">
									<div class="btn-right" id="div_btnSave">
										<button class="Button btn bg-red" onclick="addNamespace();">저장</button>
									</div>
								</div>
							</div>
							<!-- 멤버관리 -->
							<div id="div_member" style="display: none">
								<p class="intab-txt">Namespace 멤버 권한 정보를 관리합니다.</p>
								<!-- search-wrap-->
								<div class="search-wrap">
									<input class="Textinput srcinput" id="searchWord1"
										placeholder="검색어를 입력하세요." />
									<button class="Button btn-search" onclick="search1()">검색</button>
								</div>
								<h3 class="form-title">멤버</h3>
								<div id="grid_member"></div>


								<div class="btn-wrap">
									<div class="btn-left">
										<button class="Button btn" onclick="showPopAddMember()">멤버생성</button>
									</div>
									<div class="btn-right" id="div_search2" style="display: none">
										<input class="Textinput srcinput" id="searchWord2"
											placeholder="검색어를 입력하세요." />
										<button class="Button btn-search" onclick="search2()">검색</button>
									</div>
								</div>
								<br />
								<div id="div_grid_user" style="display: none">
									<h3 class="form-title">멤버 추가</h3>
									<div id="grid_user"></div>
								</div>

							</div>
							<!-- Secret -->
							<div id="div_secret" style="display: none;">

								<p class="intab-txt">Secret 정보를 관리합니다.</p>
								<div class="search-wrap">
									<input class="Textinput srcinput" name="keyword" id="keyword"
										placeholder="검색어를 입력하세요." />
									<button class="Button btn-search" id="btnSearch">검색</button>
								</div>
								<div class="form-btn__wrap">
									<h3 class="form-title" style="margin-bottom: 0px;">Secret
										목록</h3>
									<div class="btn-wrap__right">
										<button class="Button btn-ico__typeb btn-addchannel"
											th:id="btnSecretAdd">Secret 추가</button>
										<div class="Tooltip" data-position="left">Secret 추가</div>
									</div>
									<div id="grid_secret"></div>
								</div>

							</div>
						</div>
					</div>
				</div>
				<!-- //contents -->
			</div>
			<!-- //main-contents -->
		</th:block>
	</div>
</body>
</html>

